FROM node:18-alpine

WORKDIR /app

# 1. Копируем только package.json для кэширования
COPY package*.json ./

# 2. Устанавливаем ВСЕ зависимости (включая dev)
RUN npm ci

# 3. Удаляем ненужные dev-зависимости после установки
RUN npm prune --omit=dev

# 4. Копируем остальной код
COPY . .

# 5. Собираем проект
RUN npm run build

EXPOSE 3000
CMD ["npm", "start"]